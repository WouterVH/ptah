<div>
  <div class="page-header">
    <h3>Local roles</h3>
  </div>

  <table class="common-table zebra-striped" tal:condition="view.local_roles">
    <tr>
      <th>Name</th>
      <th tal:repeat="role view.roles">
	${role.title}
      </th>
    </tr>
    <tal:block tal:repeat="data view.local_roles.items()">
      <tr tal:define="principal view.getPrincipal(data[0])"
	  tal:condition="principal is not None">
	<td>${principal.name}</td>
	<td tal:repeat="role view.roles">
	  <input type="checkbox" name="user-${data[0]}"
		 checked="${role.id in data[1]}" />
	</td>
      </tr>
    </tal:block>
  </table>
  <div class="actions">
    <input type="submit" class="btn primary" 
	   value="Save" name="form.buttons.savelocal" />
  </div>
</div>

<div class="page-header">
  <h3>Search users</h3>
</div>

<tal:block content="structure view.pagelet('form-view', view)" />

<div tal:condition="view.users">
  <div class="page-header">
    <h2>Users</h2>
  </div>

  <form method="post" action="${request.url}">
    <table class="common-table zebra-striped"
	   tal:define="uids request.params.getall('uid')">
      <tr>
	<th>Name</th>
	<th tal:repeat="role view.roles">
	  ${role.title}
	</th>
      </tr>
      <tr tal:repeat="user view.users">
	<td>${user.name} (${user.login})
	  <input type="hidden" name="userid-${user.uuid}" value="on" />
	</td>
	<td tal:repeat="role view.roles">
	  <input type="checkbox" name="${name}"
		 tal:define="name 'user-%s-%s'%(user.uuid, role.id)"
		 checked="${name in request.POST}" />
	</td>
      </tr>
    </table>
    <div class="actions">
      <input type="submit" class="btn primary" 
	     value="Save" name="form.buttons.save" />
    </div>
  </form>
</div>
